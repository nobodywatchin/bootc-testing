#!/bin/sh
# Prefer a project justfile; else use global/system default.
find_up() {
  dir="$PWD"
  while :; do
    [ -f "$dir/justfile" ] && return 0
    [ -f "$dir/Justfile" ] && return 0
    [ "$dir" = "/" ] && return 1
    dir="$(dirname "$dir")"
  done
}

if find_up; then
  exec /usr/bin/just "$@"
else
  # Try user-global first if it exists, else system default.
  if [ -f "$XDG_CONFIG_HOME/just/justfile" ]; then
    exec /usr/bin/just --justfile "$XDG_CONFIG_HOME/just/justfile" "$@"
  elif [ -f "$HOME/.config/just/justfile" ]; then
    exec /usr/bin/just --justfile "$HOME/.config/just/justfile" "$@"
  else
    exec /usr/bin/just --justfile /etc/just/justfile "$@"
  fi
fi
