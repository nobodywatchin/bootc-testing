polkit.addRule(function(action, subject) {
  var ok = subject.isInGroup("wheel") && subject.active && subject.local;

  function inList(list, id) {
    for (var i = 0; i < list.length; i++) if (list[i] === id) return true;
    return false;
  }
  function hasPrefix(id, p) { return id.substr(0, p.length) === p; }

  // --- NetworkManager (passwordless) ---
  var nm = [
    "org.freedesktop.NetworkManager.network-control",
    "org.freedesktop.NetworkManager.enable-disable-network",
    "org.freedesktop.NetworkManager.enable-disable-wifi",
    "org.freedesktop.NetworkManager.enable-disable-wwan",
    "org.freedesktop.NetworkManager.settings.modify.system",
    "org.freedesktop.NetworkManager.settings.modify.own"
  ];
  if (inList(nm, action.id)) return ok ? polkit.Result.YES : polkit.Result.NO;

  // --- Storage (UDisks2) (one-time prompt) ---
  var udisks = [
    "org.freedesktop.udisks2.filesystem-mount",
    "org.freedesktop.udisks2.filesystem-mount-system",
    "org.freedesktop.udisks2.filesystem-unmount-others",
    "org.freedesktop.udisks2.encrypted-unlock",
    "org.freedesktop.udisks2.eject-media",
    "org.freedesktop.udisks2.power-off-drive",
    "org.freedesktop.udisks2.modify-device",
    "org.freedesktop.udisks2.rescan",
    "org.freedesktop.udisks2.open-device",
    "org.freedesktop.udisks2.loop-setup",
    "org.freedesktop.udisks2.loop-delete-others"
  ];
  if (inList(udisks, action.id)) return ok ? polkit.Result.AUTH_ADMIN_KEEP : polkit.Result.NO;

  // --- Printers (cups-pk-helper) (one-time prompt) ---
  var printers = [
    "org.opensuse.cupspkhelper.mechanism.all-edit",
    "org.opensuse.cupspkhelper.mechanism.add-printer",
    "org.opensuse.cupspkhelper.mechanism.delete-printer",
    "org.opensuse.cupspkhelper.mechanism.configure-printer",
    "org.opensuse.cupspkhelper.mechanism.devices-get"
  ];
  if (inList(printers, action.id)) return ok ? polkit.Result.AUTH_ADMIN_KEEP : polkit.Result.NO;

  // --- AccountsService (Users panel) (one-time prompt) ---
  if (action.id === "org.freedesktop.accounts.user-administration")
    return ok ? polkit.Result.AUTH_ADMIN_KEEP : polkit.Result.NO;

  // --- Hostname (About â†’ Device Name) (one-time prompt) ---
  if (hasPrefix(action.id, "org.freedesktop.hostname1."))
    return ok ? polkit.Result.AUTH_ADMIN_KEEP : polkit.Result.NO;

  // --- Color (colord) (passwordless) ---
  if (hasPrefix(action.id, "org.freedesktop.color-manager."))
    return ok ? polkit.Result.YES : polkit.Result.NO;

  // --- Bluetooth (BlueZ) (passwordless) ---
  if (hasPrefix(action.id, "org.bluez."))
    return ok ? polkit.Result.YES : polkit.Result.NO;

  // --- Power (systemd-logind) (one-time prompt) ---
  var logind = [
    "org.freedesktop.login1.power-off",
    "org.freedesktop.login1.power-off-multiple-sessions",
    "org.freedesktop.login1.reboot",
    "org.freedesktop.login1.reboot-multiple-sessions",
    "org.freedesktop.login1.suspend",
    "org.freedesktop.login1.hibernate",
    "org.freedesktop.login1.handle-lid-switch",
    "org.freedesktop.login1.inhibit-block",
    "org.freedesktop.login1.inhibit-delay"
  ];
  if (inList(logind, action.id)) return ok ? polkit.Result.AUTH_ADMIN_KEEP : polkit.Result.NO;

  // fall through: no opinion
});
