// /etc/polkit-1/rules.d/25-gnome-workstation.rules
polkit.addRule(function (action, subject) {
  var ok = subject.isInGroup("wheel") && subject.active && subject.local;

  function any(list) { return list.indexOf(action.id) !== -1; }
  function startsWith(p) { return action.id.lastIndexOf(p, 0) === 0; }

  // Users (AccountsService + GNOME Control Center)
  var accounts = [
    "org.freedesktop.accounts.user-administration",
    "org.freedesktop.accounts.change-own-user-data",
    "org.gnome.controlcenter.user-accounts.administration"
  ];
  if (any(accounts) && ok) return polkit.Result.AUTH_ADMIN_KEEP;

  // Date & Time (systemd-timedated)
  var timedate = [
    "org.freedesktop.timedate1.set-ntp",
    "org.freedesktop.timedate1.set-time",
    "org.freedesktop.timedate1.set-timezone",
    "org.freedesktop.timedate1.set-local-rtc"
  ];
  if (any(timedate) && ok) return polkit.Result.AUTH_ADMIN_KEEP;

  // Hostname (systemd-hostnamed)
  var hostnamed = [
    "org.freedesktop.hostname1.set-hostname",
    "org.freedesktop.hostname1.set-static-hostname",
    "org.freedesktop.hostname1.set-machine-info"
  ];
  if (any(hostnamed) && ok) return polkit.Result.AUTH_ADMIN_KEEP;

  // Network (NetworkManager)
  var nm = [
    "org.freedesktop.NetworkManager.settings.modify.system",
    "org.freedesktop.NetworkManager.network-control",
    "org.freedesktop.NetworkManager.enable-disable-network",
    "org.freedesktop.NetworkManager.enable-disable-wifi",
    "org.freedesktop.NetworkManager.enable-disable-wwan",
    "org.freedesktop.NetworkManager.settings.modify.own"
  ];
  if (any(nm) && ok) return polkit.Result.YES;

  // Printers (cups-pk-helper)
  if (startsWith("org.opensuse.cupspkhelper.mechanism.") && ok)
    return polkit.Result.YES;

  // Color management (colord)
  var colord = [
    "org.freedesktop.color-manager.create-device",
    "org.freedesktop.color-manager.create-profile",
    "org.freedesktop.color-manager.delete-device",
    "org.freedesktop.color-manager.delete-profile",
    "org.freedesktop.color-manager.modify-device",
    "org.freedesktop.color-manager.modify-profile"
  ];
  if (any(colord) && ok) return polkit.Result.YES;
  
  // ==== Firmware updates (fwupd)  << Fixes org.gnome.Firmware
  if (id.slice(0, 23) === "org.freedesktop.fwupd.") {
    return polkit.Result.AUTH_ADMIN_KEEP;
  
  // Power actions (logind)
  var logind = [
    "org.freedesktop.login1.power-off",
    "org.freedesktop.login1.power-off-multiple-sessions",
    "org.freedesktop.login1.reboot",
    "org.freedesktop.login1.reboot-multiple-sessions",
    "org.freedesktop.login1.suspend",
    "org.freedesktop.login1.hibernate",
    "org.freedesktop.login1.handle-lid-switch"
  ];
    return polkit.Result.YES;

  // Everything else: fall back to system defaults
});
