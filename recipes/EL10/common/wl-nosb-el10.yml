modules:
  # 1) Enable RPM Fusion (EL10)
  - type: dnf
    repos:
      keys:
        - https://download1.rpmfusion.org/free/el/RPM-GPG-KEY-rpmfusion-free-el-10
        - https://download1.rpmfusion.org/nonfree/el/RPM-GPG-KEY-rpmfusion-nonfree-el-10
    install:
      packages:
        - https://mirrors.rpmfusion.org/free/el/rpmfusion-free-release-10.noarch.rpm
        - https://mirrors.rpmfusion.org/nonfree/el/rpmfusion-nonfree-release-10.noarch.rpm

  # 2) Install wl stack (akmod path)
  - type: dnf
    install:
      install-weak-deps: false
      packages:
        - broadcom-wl
        - iw
        - wpa_supplicant

  # 3) Remove RPM Fusion repos (leave wl installed)
  - type: containerfile
    snippets:
      - |
        RUN set -euo pipefail; \
            dnf -y remove 'rpmfusion-*-release' || true; \
            rm -f /etc/yum.repos.d/rpmfusion-*.repo || true