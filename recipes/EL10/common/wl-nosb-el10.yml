---
modules:
  # 1) RPM Fusion (EL10)
  - type: dnf
    repos:
      keys:
        - https://download1.rpmfusion.org/free/el/RPM-GPG-KEY-rpmfusion-free-el-10
        - https://download1.rpmfusion.org/nonfree/el/RPM-GPG-KEY-rpmfusion-nonfree-el-10
    install:
      packages:
        - https://mirrors.rpmfusion.org/free/el/rpmfusion-free-release-10.noarch.rpm
        - https://mirrors.rpmfusion.org/nonfree/el/rpmfusion-nonfree-release-10.noarch.rpm

  # 2) wl via AKMOD + minimal build deps (no Secure Boot bits)
  - type: dnf
    install:
      install-weak-deps: false
      packages:
        - akmods
        - akmod-wl
        - kernel-devel
        - kernel-headers
        - gcc
        - make
        - NetworkManager

  # 3) Blacklist conflicts + auto-build/load on boot
  - type: script
    scripts:
      - broadcom-wl-nosb-setup.sh

  # 4) Enable AKMod Services
  - type: systemd
    system:
      enabled:
        - akmods.service
        - wl-ensure.service

  # 5) Drop RPM Fusion repo files/keys so Negativo17 can be used later
  - type: containerfile
    snippets:
      - |
        RUN rm -f /etc/yum.repos.d/rpmfusion-*.repo \
               /etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-* || true
