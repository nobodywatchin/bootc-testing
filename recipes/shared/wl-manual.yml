---
modules:
  # 1) Import keys + add repos via release RPMs (EL9/EL10 via %OS_VERSION%)
  - type: dnf
    repos:
      keys:
        - https://rpmfusion.org/free/el/updates/%RHEL_VERSION%/x86_64/repodata/repomd.xml.key
        - https://rpmfusion.org/nonfree/el/updates/%RHEL_VERSION%/x86_64/repodata/repomd.xml.key
    install:
      # URLs are supported in `packages:` (module installs them first). 
      # Then the repos exist for the next module. 
      packages:
        - https://mirrors.rpmfusion.org/free/el/rpmfusion-free-release-%RHEL_VERSION%.noarch.rpm
        - https://mirrors.rpmfusion.org/nonfree/el/rpmfusion-nonfree-release-%RHEL_VERSION%.noarch.rpm

  # 2) Now install wl + akmods + build/signing deps (no weak deps)
  - type: dnf
    install:
      install-weak-deps: false
      packages:
        # Broadcom wl stack
        - broadcom-wl
        - akmod-wl
        - akmods
        - kernel-devel
        - kernel-headers
        # Toolchain for akmods build
        - gcc
        - make
        - perl
        - elfutils-libelf-devel
        - rpm-build
        # Secure Boot keygen/enrollment helpers
        - openssl
        - mokutil

  # 3) Drop RPM Fusion repo files/keys so Negativo17 can be used later
  - type: containerfile
    snippets:
      - |
        RUN rm -f /etc/yum.repos.d/rpmfusion-*.repo \
               /etc/pki/rpm-gpg/RPM-GPG-KEY-rpmfusion-* || true
